---
- name: download Couchdb {{ couchdb_version }}
  unarchive:
    src: "{{ couchdb_download_url }}"
    validate_certs: "{{ couchdb_download_validate_certs }}"
    dest: "{{ couchdb_workspace }}"
    remote_src: yes
    creates: "{{ couchdb_workspace }}/COPYING-{{ couchdb_version }}"

- name: create couchdb group
  group:
    name: couchdb
    state: present

- name: create couchdb user
  user:
    name: couchdb
    shell: /bin/bash
    group: couchdb
    createhome: no
    state: present

- name: create log directory
  file:
    path: /var/log/couchdb
    state: directory
    owner: couchdb
    group: couchdb

- name: Copy Couchdb systemd unit file into place (for systemd systems)
  template:
    src: etc/systemd/system/couchdb.service.j2
    dest: /etc/systemd/system/couchdb.service
    owner: root
    group: root
    mode: 0755
  when: "ansible_service_mgr == 'systemd'"